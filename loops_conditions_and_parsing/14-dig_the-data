#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code, counting occurrences and displaying them in descending order.

# Check if log file is provided and not empty
if [[ ! -f "$1" ]] || [[ ! -s "$1" ]]; then
    echo "Log file is empty or not provided."
    exit 0
fi

# Process the log file using awk to extract and count occurrences
awk '
    # Only process lines containing valid IP and HTTP status code patterns
    match($0, /([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+).* ([0-9]{3})/, groups) {
        ip_status = groups[1] " " groups[2]
        count[ip_status]++
    }
    END {
        # Print each entry in format "count IP HTTP_CODE" for sorting externally
        for (entry in count) {
            print count[entry], entry
        }
    }
' "$1" | sort -rn

