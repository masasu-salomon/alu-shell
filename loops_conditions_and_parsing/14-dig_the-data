#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code, counting occurrences and displaying them in descending order.

# Check if log file is provided and not empty
if [[ ! -f "$1" ]] || [[ ! -s "$1" ]]; then
    echo "Log file is empty or not provided."
    exit 0
fi

# Process the log file using awk to extract, count, and sort in descending order
awk '
    # Only process lines containing valid IP and HTTP status code patterns
    match($0, /([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+).* ([0-9]{3})/, groups) {
        ip_status = groups[1] " " groups[2]
        count[ip_status]++
    }
    END {
        # Check if any entries were found; if not, output appropriate message
        if (length(count) == 0) {
            print "No valid entries found in the log file."
        } else {
            # Print each entry sorted by count in descending order
            for (entry in count) {
                print count[entry], entry | "sort -rn"
            }
        }
    }
' "$1"

