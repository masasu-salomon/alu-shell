#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code, counting occurrences and displaying them in descending order.

# Check if log file is passed as an argument
if [[ -z "$1" ]]; then
    echo "Usage: $0 <logfile>"
    exit 1
fi

# Process the log file using awk to extract, count, and sort in descending order
awk '
    # Filter lines for IP and HTTP status code
    match($0, /([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+).* ([0-9]{3})/, groups) {
        ip_status = groups[1] " " groups[2]
        count[ip_status]++
    }
    END {
        # Print counts and sort by occurrences in descending order
        for (entry in count) print count[entry], entry | "sort -rn"
    }
' "$1"

